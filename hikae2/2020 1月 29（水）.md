---
Created: 2020-01-29T08:58
Updated: 2020-01-31T10:26
---
ポスグレの、

6.OSユーザ名と同名のPostgreSQLのユーザを作成する

＞この辺の理解はかなり曖昧。

ユーザーとかPOStgreツールとか。

```Plain
$ sudo su postgres


```

**su**は、他のユーザーに切り替えるコマンド（substitute user）です。

11:07

ターミナルを起動して、すぐに、

```Plain
$ psql -d goya


```

と入力すればすぐデータベースが開く。

```Plain
date >= '2015-09-01';
（２０１５年９月１日以降）
```

>SQLにおけるDate形式は文字列なので、' 、シングルクォーテーションで囲む。

（notが全体にかかることによって、反転した範囲のデータが全て抽出されてしまったのです）

このあたりの内容は、高校数学の「かつ」「または」と全く同じなので、昔を思い出しながら考えてみてください。

>NOTがORに反転した、ということ。論理演算

小さい順ではなく、大きい順に並べたい場合はオプションに DESCと記載します。

>ディセンダント、だとなぜか覚えられない。

＞デスク、と覚えると打ち間違いが減るようだ

```Plain
goya=# SELECT * FROM crops WHERE
length <= 20 
weight <= 300 AND
ORDER BY weight DESC, length DESC
LIMIT 4 OFFSET 10;
```

>これはエラーになった。

なぜなら、ANDの位置が誤りだから。

長さと重さ等のWHERE条件節をANDで並列して取り出すことは受付されるが、

OREDR BY　以降は検索ではなく表示の条件になるので、むしろANDが入っていると構文エラーとなる。

asは表示するカラム名を任意のものに変更するオプションです。

>alias かな？

```Plain
goya=# SELECT COUNT(*) AS "収穫数", SUM(weight), AVG(weight), MAX(weight), MIN(weight), give_for
FROM crops
GROUP BY give_for
ORDER BY "収穫数" DESC;
```

>つまり、ASで別名を与えたら、その後のORDER　BYのソート鍵も別名にしないとえらーになるということだ。

COUNT　のままだと構文エラーとなる。

```Plain
goya=# SELECT crops.give_for, COUNT(*), ROUND(AVG(length)), ROUND(AVG(weight)), SUM(price)
FROM crops
JOIN prices ON crops.give_for = prices.give_for WHERE length>=20 AND
weight >= 200 AND
quality = true
ORDER BY sales DESC
GROUP BY crops.give_for
```

ERROR: syntax error at or near "GROUP"

＞あぁん？　なんで？

19:20

RDBMS課題、

```Plain
SELECT 'division_name', COUNT( * ) FROM members JOIN divisions ON members.division_id = divisions.division_id GROUP BY divisions.division_name;
```

＞これではだめですね。

正解はこちら（嘘。まだ欠陥があった。詳細は下部）。

```Plain
SELECT divisions.division_name, COUNT( * ) FROM members JOIN divisions ON members.division_id = divisions.division_id GROUP BY divisions.division_name;
```

＞つまり、JOINによって２つの表を結合させた場合、SELECT文で列を指定するときもどちらの表の列かをハッキリ書いてやらないと、

```Plain
   ?column?    | count 
---------------+-------
 division_name |     2
 division_name |     2
 division_name |     6
 division_name |     2
(4 rows)
```

＞というテーブルができてしまう。

SQLが ?column?　と表示しているのも、「どの列？」というサインを出している、ということなのかもしれない。

```Plain
SELECT divisions.division_name, COUNT( * ) FROM members JOIN divisions ON members.division_id = divisions.division_id GROUP BY divisions.division_name, members.division_id ORDER BY members.division_id;
```

＞RDBMS課題の手間取りの件。

PostgreSQLの仕様から、JOINで連結した場合、主となる左表に無いキーを使おうとした場合（？）、

計算対象となる内部的なテーブルの範囲から外れてしまうのでエラーとなる。SQL文の実行順序に関わることらしい。SELECT文は最後に評価される。最初はFROMから、内部的な抽出範囲が指定され、その後に後ろまで順に実行し、最後にSELECTでビューが完成する。

これが抜けていたので、ORDER　BYでいくら書き込んでも、文が通らなかったのだ。

これを防ぐには、GROUP　BYで明示的にそのキーを範囲に含めることを書き込んでやらないといけない。

---

青ブリーフはどうも玉袋のホールド感が弱いような。股にすぐ皮膚が張り付くような違和感が消えない。

トイックの結果が出たが、またしてもいまいち。

リスニング４００，リーディング３９５で合計７９５。

おかしいな、まだリーディングのほうが弱いのか？

せっかく最終ページを見たのに。

全然上達しなくて嫌になる。９００点台は遠い。

外回り、つまり、と　のつくほうが時計回り

山手線進行方向の覚え方。

2020 1月 29（水）,08:58

わかりみsql

メンター後藤氏オススメ図書

2020 1月 29（水）,21:22

sqlzoo

sqlシミュレーション学習サイト

2020 1月 29（水）,21:22